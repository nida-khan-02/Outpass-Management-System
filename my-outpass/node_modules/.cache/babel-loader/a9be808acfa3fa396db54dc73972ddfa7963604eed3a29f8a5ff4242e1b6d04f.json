{"ast":null,"code":"'use strict';\n\n/*!\n * Module dependencies.\n */\nconst EventEmitter = require('events').EventEmitter;\n\n/*!\n * ignore\n */\n\nconst driverChangeStreamEvents = ['close', 'change', 'end', 'error', 'resumeTokenChanged'];\n\n/*!\n * ignore\n */\n\nclass ChangeStream extends EventEmitter {\n  constructor(changeStreamThunk, pipeline, options) {\n    super();\n    this.driverChangeStream = null;\n    this.closed = false;\n    this.bindedEvents = false;\n    this.pipeline = pipeline;\n    this.options = options;\n    if (options && options.hydrate && !options.model) {\n      throw new Error('Cannot create change stream with `hydrate: true` ' + 'unless calling `Model.watch()`');\n    }\n    this.$driverChangeStreamPromise = new Promise((resolve, reject) => {\n      // This wrapper is necessary because of buffering.\n      changeStreamThunk((err, driverChangeStream) => {\n        if (err != null) {\n          this.emit('error', err);\n          return reject(err);\n        }\n        this.driverChangeStream = driverChangeStream;\n        this.emit('ready');\n        resolve();\n      });\n    });\n  }\n  _bindEvents() {\n    if (this.bindedEvents) {\n      return;\n    }\n    this.bindedEvents = true;\n    if (this.driverChangeStream == null) {\n      this.$driverChangeStreamPromise.then(() => {\n        this.driverChangeStream.on('close', () => {\n          this.closed = true;\n        });\n        driverChangeStreamEvents.forEach(ev => {\n          this.driverChangeStream.on(ev, data => {\n            if (data != null && data.fullDocument != null && this.options && this.options.hydrate) {\n              data.fullDocument = this.options.model.hydrate(data.fullDocument);\n            }\n            this.emit(ev, data);\n          });\n        });\n      }, () => {} // No need to register events if opening change stream failed\n      );\n      return;\n    }\n    this.driverChangeStream.on('close', () => {\n      this.closed = true;\n    });\n    driverChangeStreamEvents.forEach(ev => {\n      this.driverChangeStream.on(ev, data => {\n        if (data != null && data.fullDocument != null && this.options && this.options.hydrate) {\n          data.fullDocument = this.options.model.hydrate(data.fullDocument);\n        }\n        this.emit(ev, data);\n      });\n    });\n  }\n  hasNext(cb) {\n    return this.driverChangeStream.hasNext(cb);\n  }\n  next(cb) {\n    if (this.options && this.options.hydrate) {\n      if (cb != null) {\n        const originalCb = cb;\n        cb = (err, data) => {\n          if (err != null) {\n            return originalCb(err);\n          }\n          if (data.fullDocument != null) {\n            data.fullDocument = this.options.model.hydrate(data.fullDocument);\n          }\n          return originalCb(null, data);\n        };\n      }\n      let maybePromise = this.driverChangeStream.next(cb);\n      if (maybePromise && typeof maybePromise.then === 'function') {\n        maybePromise = maybePromise.then(data => {\n          if (data.fullDocument != null) {\n            data.fullDocument = this.options.model.hydrate(data.fullDocument);\n          }\n          return data;\n        });\n      }\n      return maybePromise;\n    }\n    return this.driverChangeStream.next(cb);\n  }\n  addListener(event, handler) {\n    this._bindEvents();\n    return super.addListener(event, handler);\n  }\n  on(event, handler) {\n    this._bindEvents();\n    return super.on(event, handler);\n  }\n  once(event, handler) {\n    this._bindEvents();\n    return super.once(event, handler);\n  }\n  _queue(cb) {\n    this.once('ready', () => cb());\n  }\n  close() {\n    this.closed = true;\n    if (this.driverChangeStream) {\n      return this.driverChangeStream.close();\n    } else {\n      return this.$driverChangeStreamPromise.then(() => this.driverChangeStream.close(), () => {} // No need to close if opening the change stream failed\n      );\n    }\n  }\n}\n\n/*!\n * ignore\n */\n\nmodule.exports = ChangeStream;","map":{"version":3,"names":["EventEmitter","require","driverChangeStreamEvents","ChangeStream","constructor","changeStreamThunk","pipeline","options","driverChangeStream","closed","bindedEvents","hydrate","model","Error","$driverChangeStreamPromise","Promise","resolve","reject","err","emit","_bindEvents","then","on","forEach","ev","data","fullDocument","hasNext","cb","next","originalCb","maybePromise","addListener","event","handler","once","_queue","close","module","exports"],"sources":["E:/Out/my-outpass/node_modules/mongoose/lib/cursor/changeStream.js"],"sourcesContent":["'use strict';\n\n/*!\n * Module dependencies.\n */\n\nconst EventEmitter = require('events').EventEmitter;\n\n/*!\n * ignore\n */\n\nconst driverChangeStreamEvents = ['close', 'change', 'end', 'error', 'resumeTokenChanged'];\n\n/*!\n * ignore\n */\n\nclass ChangeStream extends EventEmitter {\n  constructor(changeStreamThunk, pipeline, options) {\n    super();\n\n    this.driverChangeStream = null;\n    this.closed = false;\n    this.bindedEvents = false;\n    this.pipeline = pipeline;\n    this.options = options;\n\n    if (options && options.hydrate && !options.model) {\n      throw new Error(\n        'Cannot create change stream with `hydrate: true` ' +\n        'unless calling `Model.watch()`'\n      );\n    }\n\n    this.$driverChangeStreamPromise = new Promise((resolve, reject) => {\n      // This wrapper is necessary because of buffering.\n      changeStreamThunk((err, driverChangeStream) => {\n        if (err != null) {\n          this.emit('error', err);\n          return reject(err);\n        }\n\n        this.driverChangeStream = driverChangeStream;\n        this.emit('ready');\n        resolve();\n      });\n    });\n  }\n\n  _bindEvents() {\n    if (this.bindedEvents) {\n      return;\n    }\n\n    this.bindedEvents = true;\n\n    if (this.driverChangeStream == null) {\n      this.$driverChangeStreamPromise.then(\n        () => {\n          this.driverChangeStream.on('close', () => {\n            this.closed = true;\n          });\n\n          driverChangeStreamEvents.forEach(ev => {\n            this.driverChangeStream.on(ev, data => {\n              if (data != null && data.fullDocument != null && this.options && this.options.hydrate) {\n                data.fullDocument = this.options.model.hydrate(data.fullDocument);\n              }\n              this.emit(ev, data);\n            });\n          });\n        },\n        () => {} // No need to register events if opening change stream failed\n      );\n\n      return;\n    }\n\n    this.driverChangeStream.on('close', () => {\n      this.closed = true;\n    });\n\n    driverChangeStreamEvents.forEach(ev => {\n      this.driverChangeStream.on(ev, data => {\n        if (data != null && data.fullDocument != null && this.options && this.options.hydrate) {\n          data.fullDocument = this.options.model.hydrate(data.fullDocument);\n        }\n        this.emit(ev, data);\n      });\n    });\n  }\n\n  hasNext(cb) {\n    return this.driverChangeStream.hasNext(cb);\n  }\n\n  next(cb) {\n    if (this.options && this.options.hydrate) {\n      if (cb != null) {\n        const originalCb = cb;\n        cb = (err, data) => {\n          if (err != null) {\n            return originalCb(err);\n          }\n          if (data.fullDocument != null) {\n            data.fullDocument = this.options.model.hydrate(data.fullDocument);\n          }\n          return originalCb(null, data);\n        };\n      }\n\n      let maybePromise = this.driverChangeStream.next(cb);\n      if (maybePromise && typeof maybePromise.then === 'function') {\n        maybePromise = maybePromise.then(data => {\n          if (data.fullDocument != null) {\n            data.fullDocument = this.options.model.hydrate(data.fullDocument);\n          }\n          return data;\n        });\n      }\n      return maybePromise;\n    }\n\n    return this.driverChangeStream.next(cb);\n  }\n\n  addListener(event, handler) {\n    this._bindEvents();\n    return super.addListener(event, handler);\n  }\n\n  on(event, handler) {\n    this._bindEvents();\n    return super.on(event, handler);\n  }\n\n  once(event, handler) {\n    this._bindEvents();\n    return super.once(event, handler);\n  }\n\n  _queue(cb) {\n    this.once('ready', () => cb());\n  }\n\n  close() {\n    this.closed = true;\n    if (this.driverChangeStream) {\n      return this.driverChangeStream.close();\n    } else {\n      return this.$driverChangeStreamPromise.then(\n        () => this.driverChangeStream.close(),\n        () => {} // No need to close if opening the change stream failed\n      );\n    }\n  }\n}\n\n/*!\n * ignore\n */\n\nmodule.exports = ChangeStream;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}